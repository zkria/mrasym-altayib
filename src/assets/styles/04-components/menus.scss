// متغيرات القائمة الرئيسية
:root {
  --menu-item-padding: 0.75rem 1rem;
  --menu-transition: 300ms ease;
  --submenu-width: 220px;
  --menu-item-height: 48px;
  --menu-hover-bg: theme('colors.gray.200' / 20%);
  --menu-text: theme('colors.gray.700');
  --menu-hover-text: var(--color-primary);
  
  // متغيرات الوضع المظلم
  --menu-dark-text: theme('colors.gray.200');
  --menu-dark-bg: theme('colors.gray.800');
  --menu-dark-hover-bg: theme('colors.gray.700' / 20%);
}

// القائمة الرئيسية
.main-menu > li > a[href*="offer"] {
  @apply text-red-800;
}

@media only screen and (min-width: 1024px) {
  .main-menu {
    @apply hidden lg:flex flex-wrap items-center mx-6 pt-8 pb-0;
    
    .fixed-pinned & {
      padding-top: 0;
      padding-bottom: 0;
    }

    li {
      > a {
        @apply flex justify-between items-center;
        padding: var(--menu-item-padding);
        transition: var(--menu-transition);
        color: var(--menu-text);
        font-size: 0.875rem;
        
        &:hover {
          color: var(--menu-hover-text);
          @apply no-underline;
        }
      }

      &.root-level {
        @apply inline-block;
        
        > a {
          @apply font-bold pt-0 pb-8;
        }
      }
    }

    // القوائم الفرعية
    .sub-menu {
      @apply z-20;
      position: absolute;
      background: #fff;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-0.75rem) translateZ(0);
      transition: all var(--menu-transition);
      will-change: transform, opacity;
      box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
      border-top: 1px solid theme('colors.gray.300' / 30%);
      border-radius: 0 0 0.375rem 0.375rem;

      .sub-menu {
        top: -1px;
        right: 100%;
        border-radius: 0.375rem;

        [dir="ltr"] & {
          left: 100%;
          right: auto;
        }
      }

      li.mega-menu .container {
        ul {
          @apply p-0 m-0 border-none;
        }
        > div {
          @apply hidden;
        }
      }
    }

    // تحسين التفاعل مع القوائم
    .has-children {
      > a:after {
        font-family: 'sallaicons';
        content: "\e970";
        @apply inline-block transition-transform duration-300 self-end mx-0.5 text-lg opacity-50 leading-4;
      }

      &.root-level {
        > a:after {
          content: "\e96e";
        }

        &:hover > a:after {
          opacity: 1;
          transform: scaleY(-1);
        }
      }

      &:hover > a {
        color: var(--menu-hover-text);
      }
    }

    // تفعيل القوائم الفرعية
    li:hover {
      > .sub-menu {
        opacity: 1;
        visibility: visible;
        transform: translateY(0) translateZ(0);
      }
    }
  }
}

// القائمة المتنقلة
@media only screen and (max-width: 1024px) {
  .mobile-menu {
    display: none;
    @apply lg:hidden;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior-y: contain;
    backface-visibility: hidden;
    transform: translateZ(0);
  }

  .mm-spn {
    &.mm-spn--light {
      background: var(--menu-dark-bg);
      color: var(--menu-dark-text);
    }

    li {
      @apply touch-pan-y;
      min-height: var(--menu-item-height);

      a, > span {
        padding: 1.125rem;
        @apply flex items-center gap-4;
      }

      img {
        @apply w-12 h-12 object-cover bg-[#f5f7f9] pointer-events-none;
      }

      &:before {
        @apply w-2 h-2;
        
        [dir="rtl"] & {
          width: 6px;
          height: 6px;
          top: 50%;
          left: 25px;
          left: calc(var(--mm-spn-item-height) / 2);
          right: auto;
          border-bottom: 1px solid;
          border-left: 1px solid;
          border-right: none;
          border-top: none;
        }
      }
    }
  }

  // حالات خاصة للقائمة المتنقلة
  .filters-opened .close-filters,
  .menu-opened .btn--close-sm.close-mobile-menu {
    display: block !important;
  }

  .mm-ocd-opened {
    .mobile-menu {
      display: block;
    }

    @media (max-width: 480px) {
      .btn--close-sm {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
        z-index: 99999999;
      }
    }
  }
}

// دعم الوضع المظلم
@media (prefers-color-scheme: dark) {
  .main-menu {
    --menu-text: var(--menu-dark-text);
    --menu-hover-bg: var(--menu-dark-hover-bg);
    
    .sub-menu {
      background: var(--menu-dark-bg);
      border-color: theme('colors.gray.700');
    }
  }
}

// تحسينات accessibility
.main-menu, .mobile-menu {
  @apply outline-none;
  
  a:focus-visible {
    @apply ring-2 ring-primary ring-offset-2;
  }
}