{#
| المتغيرات        | النوع    | الوصف                           |
|------------------|---------|---------------------------------|
| cart             | كائن    |                                 |
| cart.items_count | عدد صحيح |                                 |
| cart.total       | سلسلة   | المجموع المنسق مثل: "١٠٠ ر.س"   |
#}
{% set important_links = theme.settings.get('important_links') %}
{% set is_sidebar_open = false %}

<link rel="stylesheet" href="/src/assets/styles/05-utilities/dark-mode.scss">
<script src="/src/assets/js/pages/dark-mode.js"></script>

<header class="store-header">
  {# شريط التنقل العلوي - محسن #}
  <div class="top-navbar bg-gray-800 text-white shadow-lg p-4">
    <div class="container flex justify-between items-center">
      {# زر فتح القائمة في الهيدر #}
      <button 
        class="hamburger-menu p-2 rounded hover:bg-gray-700 transition duration-300"
        id="openSidebarBtn"
        aria-label="فتح القائمة الجانبية"
        aria-expanded="false"
        aria-controls="mainnav">
        <i class="sicon-menu text-2xl text-white"></i>
      </button>
      
      {# زر البحث - محسن #}
      <div class="header-search ml-4">
        <salla-search 
          inline 
          oval 
          height="36" 
          placeholder="ابحث في المتجر..."
          aria-label="بحث في المتجر">
        </salla-search>
      </div>
      
      {# الشعار في المنتصف #}
      <div class="flex-1 flex justify-center">
        <a class="navbar-brand" href="{{ store.url }}" aria-label="{{ store.name }}">
          <img 
            width="150"
            height="50"
            loading="eager"
            decoding="async"
            fetchpriority="high"
            src="{{ store.logo }}"
            alt="{{ store.name }}"
            class="logo-image"
            srcset="{{ store.logo }} 1x, {{ store.logo_retina }} 2x"
          >
        </a>
      </div>
      
      {# الأزرار في اليمين - تحسين #}
      <div class="header-actions flex items-center gap-4">
        {# زر تفعيل الوضع الداكن - الزر الجديد #}
        <button type="button" 
                id="theme-button"
                class="header-btn text-white bg-gray-800 hover:bg-gray-700 transition duration-300 ease-in-out rounded-lg p-3 shadow-md text-lg flex items-center"
                aria-label="تفعيل الوضع الداكن">
          <i class="sicon-moon text-xl"></i>
        </button>

        {# زر المستخدم #}
        {% if user.type == 'user' %}
          <salla-user-menu 
            avatar-only 
            show-header
            class="text-white"
            aria-label="قائمة المستخدم">
          </salla-user-menu>
        {% else %}
          <button 
            class="header-btn text-white bg-gray-800 hover:bg-gray-700 transition duration-300 ease-in-out rounded-full w-10 h-10 flex items-center justify-center shadow-md"
            aria-label="تسجيل الدخول"
            onclick="salla.event.dispatch('login::open')">
            <i class="header-btn__icon sicon-user-circle text-2xl" aria-hidden="true"></i>
          </button>
        {% endif %}

        {# سلة التسوق - تحسين #}
        <salla-cart-summary 
          class="flex items-center"
          aria-label="سلة التسوق - {{ cart.items_count }} منتجات">
          <i slot="icon" 
             class="header-btn__icon icon sicon-shopping-bag text-white text-2xl"
             aria-hidden="true">
          </i>
        </salla-cart-summary>
      </div>
    </div>
  </div>

  {# القائمة الجانبية - تم تعديل الموضع #}
  <nav id="mainnav" class="main-nav-sidebar absolute top-full right-0 w-72 bg-white shadow-lg transition-transform duration-300 z-10" aria-label="القائمة الرئيسية">
      <div id="sidebar-content" class="sidebar-content overflow-y-auto max-h-screen">
        <div class="sidebar-header">
          <h2>القائمة الرئيسية</h2>
        </div>
        <custom-main-menu 
          id="mainMenu"
          class="sidebar-nav vertical-menu flex-grow"
          mobile="true"
          show-categories="true"
          show-brands="true">
        </custom-main-menu>
      </div>
  </nav>
</header>

{% if store.scope %}
  <salla-scopes 
    selection="{{ store.scope.display_as == 'popup' ? 'mandatory' : 'optional' }}"
    aria-label="اختيار النطاق">
  </salla-scopes>
{% endif %}

