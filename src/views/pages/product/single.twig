{#
| المتغير                                | النوع                       | الوصف                                                                |
|----------------------------------------|-----------------------------|----------------------------------------------------------------------|
| page                                    | object                      |                                                                        |
| page.title                             | string                      | *يمكن أن يحتوي على HTML                                               |
| page.slug                              | string                      | مثال: "cat.show"                                                      |
| product                                | Product                     |                                                                        |
| product.id                             | int                         |                                                                        |
| product.name                           | string                      |                                                                        |
| product.description                    | string                      | HTML                                                                   |
| product.url                            | string                      |                                                                        |
| product.promotion_title                | string                      |                                                                        |
| product.subtitle                       | string                      |                                                                        |
| product.type                           | string                      | منتج، خدمة، مجموعة_منتجات، أكواد، رقمي، طعام، تبرع                    |
| product.status                         | string                      | للبيع، نفذ، نفذ-مع-الإشعار                                            |
| product.weight                         | ?string                     |                                                                        |
| product.calories                       | ?float                      |                                                                        |
| product.sku                            | ?string                      |                                                                        |
| product.rating                         | ?Rating                     |                                                                        |
| product.rating.count                   | int                         |                                                                        |
| product.rating.stars                   | int                         |                                                                        |
| product.price                          | float                       | يمكن أن يكون نصياً أيضاً `-` عندما لا يريد التاجر إظهار الصفر         |
| product.sale_price                     | float                       |                                                                        |
| product.regular_price                  | float                       |                                                                        |
| product.starting_price                 | ?float                      |                                                                        |
| product.quantity                       | ?int                        | إذا كانت القيمة null، فهذا يعني أن الكمية غير محدودة                  |
| product.sold_quantity                  | int                         |                                                                        |
| product.max_quantity                   | int                         |                                                                        |
| product.discount_ends                  | ?date                       |                                                                        |
| product.is_taxable                     | bool                        | هل الضريبة مشمولة في السعر                                            |
| product.category                       | ?Category                   |                                                                        |
| product.category.name                  | string                      |                                                                        |
| product.category.url                   | string                      |                                                                        |
| product.image                          | object                      |                                                                        |
| product.image.url                      | string                      |                                                                        |
| product.image.alt                      | ?string                     |                                                                        |
| product.images                         | array                       |                                                                        |
| product.images[].id                    | int                         |                                                                        |
| product.images[].url                   | string                      |                                                                        |
| product.images[].alt                   | ?string                     |                                                                        |
| product.images[].video_url             | ?string                     |                                                                        |
| product.images[].type                  | string                      | `صورة` `فيديو`                                                        |
| product.brand                          | ?object                     |                                                                        |
| product.brand.id                       | int                         |                                                                        |
| product.brand.url                      | ?string                     |                                                                        |
| product.brand.name                     | ?string                     |                                                                        |
| product.brand.logo                     | ?string                     |                                                                        |
| product.tags                           | ?Tags[] *Collection         |                                                                        |
| product.tags[].name                    | string                      |                                                                        |
| product.tags[].url                     | string                      |                                                                        |
| product.options                        | ProductOption[] *Collection | @انظر views/pages/partials/product/options.twig                        |
| product.notify_availability            | ?object                     | هل المنتج نفذ وهل يمكن للزائر الاشتراك للإشعار بالتوفر                |
| product.notify_availability.channels   | array                       | مثال: ['sms', 'email']                                                |
| product.notify_availability.subscribed | bool                        | هل اشترك المستخدم مسبقاً                                              |
| product.donation                       | ?ProductDonation            |                                                                        |
| product.donation.target_message        | ?string                     | رسالة عند الوصول للهدف أو انتهاء مدة الهدف                            |
| product.donation.collected_amount      | float                       |                                                                        |
| product.donation.target_amount         | float                       |                                                                        |
| product.donation.target_percent        | float                       |                                                                        |
| product.donation.target_end_date       | ?Date                       |                                                                        |
| product.donation.can_donate            | bool                        | `true` عندما لا توجد حملة أو (لم يتم الوصول للهدف ولم تنتهي المدة)    |
| product.has_read_more                  | bool                        |                                                                        |
| product.can_add_note                   | bool                        |                                                                        |
| product.can_show_remained_quantity     | bool                        |                                                                        |
| product.can_show_sold                  | bool                        |                                                                        |
| product.can_upload_file                | bool                        |                                                                        |
| product.has_custom_form                | bool                        | هل هو منتج `طعام` أو `خدمة مخصصة`                                     |
| product.has_metadata                   | bool                        |                                                                        |
| product.has_options                    | bool                        |                                                                        |
| product.is_on_sale                     | bool                        | المنتج له سعر مخفض                                                    |
| product.is_hidden_quantity             | bool                        | الكمية مخفية من قبل التاجر، أو المنتج غير متوفر                       |
| product.is_available                   | bool                        |                                                                        |
| product.is_in_wishlist                 | bool                        |                                                                        |
| product.is_out_of_stock                | bool                        |                                                                        |
| product.is_require_shipping            | bool                        |                                                                        |
| product.base_currency_price            | float                       | سعر المنتج بالعملة الأساسية (ريال سعودي)                              |
| product.discount_percentage            | ?string                     | مثال: "20%"                                                           |
| product.has_3d_image                   | bool                        |                                                                        |
| product.has_size_guide                 | bool                        |                                                                        |
| product.is_giftable                    | bool                        |                                                                        |
| product.add_to_cart_label              | string                      |                                                                        |
| product.currency                       | string                      |                                                                        |
#}

{% extends "layouts.master" %}
{% block content %}
    {# إضافة أزرار التنقل في أعلى الصفحة #}
    <nav class="breadcrumbs-wrapper">
        <div class="container">
            <salla-breadcrumb>
                {# يمكننا إضافة محتوى إضافي هنا إذا أردنا تخصيص المكون #}
            </salla-breadcrumb>
        </div>
    </nav>

    {# باقي محتوى الصفحة #}
    <div class="container">
        <div class="product-details">
            {# الجانب الأيسر - تفاصيل المنتج #}
            <div class="product-info space-y-6">
                {# عنوان المنتج #}
                <h1 class="text-xl lg:text-2xl font-bold">{{ product.name }}</h1>

                {# التقييمات والمشاركة في نفس السطر #}
                <div class="flex items-center gap-6">
                    {# التقييمات #}
                    <div class="rating-wrapper flex items-center gap-2">
                        <salla-rating-stars 
                            value="{{ product.rating.stars }}"
                            readonly>
                        </salla-rating-stars>
                        <span class="text-sm text-gray-500">
                            ({{ product.rating.count }} تقييم)
                        </span>
                    </div>

                    {# خط فاصل عمودي #}
                    <div class="h-5 w-px bg-gray-200 dark:bg-gray-700"></div>

                    {# مشاركة المنتج #}
                    <div class="share-product flex items-center gap-2">
                        <span class="text-sm text-gray-500">مشاركة:</span>
                        <salla-social-share></salla-social-share>
                    </div>
                </div>

                {# السعر #}
                <div class="price-wrapper">
                    {% if product.price != '-' %}
                        <div class="flex whitespace-nowrap gap-4 items-center">
                            <div class="{{ product.is_on_sale ? '' : 'hidden' }} space-x-2 rtl:space-x-reverse whitespace-nowrap">
                                <h4 class="text-red-800 font-bold text-xl inline-block">{{product.sale_price|money}}</h4>
                                <span class="text-gray-500 line-through">{{product.regular_price|money}}</span>
                            </div>
                            <div class="gap-4 {{ product.is_on_sale ? 'hidden' : 'flex' }}">
                                {% if product.starting_price %} 
                                    <span class="">{{ trans('pages.products.starting_price') }}</span>
                                {% endif %} 
                                <h2 class="font-bold text-xl inline-block">{{product.starting_price ? product.starting_price|money : product.price|money }}</h2>
                            </div>
                        </div>
                    {% else %}
                        <div class="text-gray-500">السعر غير متوفر</div>
                    {% endif %}
                    <div class="text-sm text-gray-500 mt-1">
                        السعر شامل الضريبة
                    </div>
                </div>
                
            </div>

            {# القسم الأيمن - معرض الصور #}
            <div class="product-gallery">
                {% if product.images|length > 0 %}
                    <div class="main-image-container relative overflow-hidden rounded-lg">
                        {# زر المفضلة #}
                        <salla-button
                            class="btn--wishlist animated absolute top-3 rtl:left-3 ltr:right-3 z-50"
                            data-id="{{ product.id }}"
                            onclick="salla.wishlist.toggle({{ product.id }})"
                            shape="icon"
                            color="light"
                            aria-label="إضافة إلى قائمة الرغبات">
                            <i class="sicon-heart {{ product.is_in_wishlist ? 'is-favorite' : '' }}"></i>
                        </salla-button>

                        {# شارة العرض الترويجي #}
                        {% if product.promotion_title %}
                            <div class="promotion-badge absolute top-3 rtl:right-3 ltr:left-3 z-40 bg-primary text-white px-3 py-1 rounded-full text-sm font-medium">
                                {{ product.promotion_title }}
                            </div>
                        {% endif %}
                        
                        {# الصورة الرئيسية #}
                        <div class="main-image-wrapper aspect-square">
                            <img src="{{ product.images[0].url }}" 
                                 alt="{{ product.name }}"
                                 id="main-product-image"
                                 class="main-image w-full h-full object-cover">
                        </div>

                        {# المصغرات #}
                        {% if product.images|length > 1 %}
                            <div class="thumbnails-wrapper mt-4">
                                <div class="thumbnails grid grid-cols-5 gap-2">
                                    {% for image in product.images %}
                                        <div class="thumbnail-item aspect-square rounded-md overflow-hidden cursor-pointer 
                                                  {{ loop.first ? 'ring-2 ring-primary' : '' }}"
                                             onclick="updateMainImage('{{ image.url }}', this)">
                                            <img src="{{ image.url }}" 
                                                 alt="{{ product.name }}"
                                                 loading="{{ loop.first ? 'eager' : 'lazy' }}"
                                                 class="w-full h-full object-cover">
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        {% endif %}
                    </div>
                {% else %}
                    <div class="no-image-placeholder aspect-square rounded-lg bg-gray-100 flex items-center justify-center">
                        <i class="sicon-image text-4xl text-gray-400"></i>
                    </div>
                {% endif %}
            </div>
        </div>

       {# ... existing code ... #}

        {# التبويبات #}
        <div class="product-tabs-container" x-data="{ activeTab: 'description' }">
            <div class="tabs-header">
                <button class="tab-btn" 
                        :class="{ 'active': activeTab === 'questions' }"
                        @click.prevent="activeTab = 'questions'">
                    الأسئلة
                </button>
                
                <button class="tab-btn" 
                        :class="{ 'active': activeTab === 'reviews' }"
                        @click.prevent="activeTab = 'reviews'">
                    التقييمات
                </button>
                
                <button class="tab-btn" 
                        :class="{ 'active': activeTab === 'description' }"
                        @click.prevent="activeTab = 'description'">
                    تفاصيل المنتج
                </button>
            </div>

            <div class="tabs-content">
                {# محتوى تبويب الأسئلة #}
                <div x-cloak x-show.transition.in.opacity.duration.600ms="activeTab === 'questions'" class="tab-panel">
                    <salla-product-questions 
                        product-id="{{ product.id }}">
                    </salla-product-questions>
                </div>

                {# محتوى تبويب التقييمات #}
                <div x-cloak x-show.transition.in.opacity.duration.600ms="activeTab === 'reviews'" class="tab-panel">
                    {% if product.rating %}
                        <div class="reviews-summary">
                            <salla-rating-stars 
                                value="{{ product.rating.stars }}" 
                                readonly>
                            </salla-rating-stars>
                            <span class="rating-count">
                                ({{ product.rating.count }} تقييم)
                            </span>
                        </div>
                        <salla-comments 
                            item-id="{{ product.id }}" 
                            type="product">
                        </salla-comments>
                    {% endif %}
                </div>

                {# محتوى تبويب تفاصيل المنتج #}
                <div x-cloak x-show.transition.in.opacity.duration.600ms="activeTab === 'description'" class="tab-panel">
                    <div class="product-description">
                        {{ product.description|raw }}
                    </div>
                    {% if product.has_metadata %}
                        <div class="product-specifications mt-6">
                            <salla-metadata></salla-metadata>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        {# المنتجات المقترحة #}
        <div class="suggested-products">
            <h3 class="section-title">منتجات مقترحة</h3>
            
            <div class="products-slider">
                <salla-products-slider 
                    source="related_products"
                    product-card-class="product-entry--minimal"
                    product-id="{{ product.id }}"
                    limit="8">
                </salla-products-slider>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script defer src="{{ 'product.js' | asset }}"></script>
    {% if product.has_3d_image %}
        <script type="module" defer src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    {% endif %}
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const tabsContainer = document.querySelector('.tabs-header');
            const tabs = tabsContainer.querySelectorAll('.tab-btn');
            const indicator = tabsContainer.querySelector('.tab-indicator');

            function setIndicator(tab) {
                indicator.style.width = tab.offsetWidth + 'px';
                indicator.style.left = tab.offsetLeft + 'px';
            }

            // تفعيل التاب الأول افتراضياً
            setIndicator(tabs[0]);
            tabs[0].classList.add('active');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // إزالة الكلاس النشط من جميع التابات
                    tabs.forEach(t => t.classList.remove('active'));
                    
                    // إضافة الكلاس النشط للتاب المحدد
                    tab.classList.add('active');
                    
                    // تحريك المؤشر
                    setIndicator(tab);
                });
            });
        });
    </script>
{% endblock %}
