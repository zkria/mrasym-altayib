{#
| المتغير                                | النوع                       | الوصف                                                                |
|----------------------------------------|-----------------------------|----------------------------------------------------------------------|
| page                                    | object                      |                                                                        |
| page.title                             | string                      | *يمكن أن يحتوي على HTML                                               |
| page.slug                              | string                      | مثال: "cat.show"                                                      |
| product                                | Product                     |                                                                        |
| product.id                             | int                         |                                                                        |
| product.name                           | string                      |                                                                        |
| product.description                    | string                      | HTML                                                                   |
| product.url                            | string                      |                                                                        |
| product.promotion_title                | string                      |                                                                        |
| product.subtitle                       | string                      |                                                                        |
| product.type                           | string                      | منتج، خدمة، مجموعة_منتجات، أكواد، رقمي، طعام، تبرع                    |
| product.status                         | string                      | للبيع، نفذ، نفذ-مع-الإشعار                                            |
| product.weight                         | ?string                     |                                                                        |
| product.calories                       | ?float                      |                                                                        |
| product.sku                            | ?string                     |                                                                        |
| product.rating                         | ?Rating                     |                                                                        |
| product.rating.count                   | int                         |                                                                        |
| product.rating.stars                   | int                         |                                                                        |
| product.price                          | float                       | يمكن أن يكون نصياً أيضاً `-` عندما لا يريد التاجر إظهار الصفر         |
| product.sale_price                     | float                       |                                                                        |
| product.regular_price                  | float                       |                                                                        |
| product.starting_price                 | ?float                      |                                                                        |
| product.quantity                       | ?int                        | إذا كانت القيمة null، فهذا يعني أن الكمية غير محدودة                  |
| product.sold_quantity                  | int                         |                                                                        |
| product.max_quantity                   | int                         |                                                                        |
| product.discount_ends                  | ?date                       |                                                                        |
| product.is_taxable                     | bool                        | هل الضريبة مشمولة في السعر                                            |
| product.category                       | ?Category                   |                                                                        |
| product.category.name                  | string                      |                                                                        |
| product.category.url                   | string                      |                                                                        |
| product.image                          | object                      |                                                                        |
| product.image.url                      | string                      |                                                                        |
| product.image.alt                      | ?string                     |                                                                        |
| product.images                         | array                       |                                                                        |
| product.images[].id                    | int                         |                                                                        |
| product.images[].url                   | string                      |                                                                        |
| product.images[].alt                   | ?string                     |                                                                        |
| product.images[].video_url             | ?string                     |                                                                        |
| product.images[].type                  | string                      | `صورة` `فيديو`                                                        |
| product.brand                          | ?object                     |                                                                        |
| product.brand.id                       | int                         |                                                                        |
| product.brand.url                      | ?string                     |                                                                        |
| product.brand.name                     | ?string                     |                                                                        |
| product.brand.logo                     | ?string                     |                                                                        |
| product.tags                           | ?Tags[] *Collection         |                                                                        |
| product.tags[].name                    | string                      |                                                                        |
| product.tags[].url                     | string                      |                                                                        |
| product.options                        | ProductOption[] *Collection | @انظر views/pages/partials/product/options.twig                        |
| product.notify_availability            | ?object                     | هل المنتج نفذ وهل يمكن للزائر الاشتراك للإشعار بالتوفر                |
| product.notify_availability.channels   | array                       | مثال: ['sms', 'email']                                                |
| product.notify_availability.subscribed | bool                        | هل اشترك المستخدم مسبقاً                                              |
| product.donation                       | ?ProductDonation            |                                                                        |
| product.donation.target_message        | ?string                     | رسالة عند الوصول للهدف أو انتهاء مدة الهدف                            |
| product.donation.collected_amount      | float                       |                                                                        |
| product.donation.target_amount         | float                       |                                                                        |
| product.donation.target_percent        | float                       |                                                                        |
| product.donation.target_end_date       | ?Date                       |                                                                        |
| product.donation.can_donate            | bool                        | `true` عندما لا توجد حملة أو (لم يتم الوصول للهدف ولم تنتهي المدة)    |
| product.has_read_more                  | bool                        |                                                                        |
| product.can_add_note                   | bool                        |                                                                        |
| product.can_show_remained_quantity     | bool                        |                                                                        |
| product.can_show_sold                  | bool                        |                                                                        |
| product.can_upload_file                | bool                        |                                                                        |
| product.has_custom_form                | bool                        | هل هو منتج `طعام` أو `خدمة مخصصة`                                     |
| product.has_metadata                   | bool                        |                                                                        |
| product.has_options                    | bool                        |                                                                        |
| product.is_on_sale                     | bool                        | المنتج له سعر مخفض                                                    |
| product.is_hidden_quantity             | bool                        | الكمية مخفية من قبل التاجر، أو المنتج غير متوفر                       |
| product.is_available                   | bool                        |                                                                        |
| product.is_in_wishlist                 | bool                        |                                                                        |
| product.is_out_of_stock                | bool                        |                                                                        |
| product.is_require_shipping            | bool                        |                                                                        |
| product.base_currency_price            | float                       | سعر المنتج بالعملة الأساسية (ريال سعودي)                              |
| product.discount_percentage            | ?string                     | مثال: "20%"                                                           |
| product.has_3d_image                   | bool                        |                                                                        |
| product.has_size_guide                 | bool                        |                                                                        |
| product.is_giftable                    | bool                        |                                                                        |
| product.add_to_cart_label              | string                      |                                                                        |
| product.currency                       | string                      |                                                                        |
#}

{% extends "layouts.master" %}
{% block content %}
    <div class="container">
        <nav class="breadcrumbs w-full py-5">
            <salla-breadcrumb></salla-breadcrumb>
        </nav>
        
        <div class="product-details flex flex-col md:flex-row gap-8">
            {# قسم الصور مع المصغرات في الأسفل #}
            <div class="md:w-1/2">
                <div class="product-gallery sticky top-24">
                    <salla-slider 
                        class="product-slider"
                        id="product-{{ product.id }}"
                        thumbs="true"
                        thumbs-position="bottom">
                        
                        {# الصور الرئيسية #}
                        <div slot="items">
                            {% for image in product.images %}
                                <div class="magnify-wrapper">
                                    <img src="{{ image.url }}"
                                         alt="{{ image.alt }}"
                                         id="image-{{ image.id }}"
                                         class="w-full aspect-square object-cover">
                                </div>
                            {% endfor %}
                        </div>
                        
                        {# المصغرات #}
                        <div slot="thumbs" class="product-thumbs">
                            {% for image in product.images %}
                                <div class="thumb-item">
                                    <img src="{{ image.url }}" 
                                         alt="{{ image.alt }}"
                                         class="w-full h-full object-cover">
                                </div>
                            {% endfor %}
                        </div>
                    </salla-slider>
                </div>
            </div>

            {# قسم المعلومات #}
            <div class="md:w-1/2">
                {# العلامة التجارية #}
                {% if product.brand %}
                    <a href="{{ product.brand.url }}" class="brand-logo mb-4 block">
                        <img src="{{ product.brand.logo }}" 
                             alt="{{ product.brand.name }}"
                             class="h-12 object-contain">
                    </a>
                {% endif %}

                {# اسم المنتج والتقييم #}
                <h1 class="text-2xl font-bold mb-4">{{ product.name }}</h1>
                {% if product.rating %}
                    <div class="product-rating mb-4">
                        <salla-rating-stars 
                            value="{{ product.rating.stars }}"
                            reviews="{{ product.rating.count }}">
                        </salla-rating-stars>
                    </div>
                {% endif %}

                {# معلومات المخزون #}
                {% if product.can_show_remained_quantity or product.sold_quantity %}
                    <div class="stock-info mb-4 bg-gray-50 p-4 rounded-lg">
                        {% if product.sold_quantity and product.can_show_sold %}
                            <div class="sold-quantity mb-2">
                                <i class="sicon-fire text-red-600"></i>
                                <span>{{ pluralize('pages.products.sold_times', product.sold_quantity)|raw }}</span>
                            </div>
                        {% endif %}
                        {% if product.can_show_remained_quantity %}
                            <div class="remaining-quantity">
                                <i class="sicon-box-bankers text-primary"></i>
                                <span>{{ trans('pages.products.remained') }}: {{ product.quantity }}</span>
                            </div>
                        {% endif %}
                    </div>
                {% endif %}

                {# السعر والخيارات #}
                <div class="product-purchase-details bg-white p-6 rounded-lg shadow-sm">
                    {# السعر #}
                    <div class="price-section mb-6">
                        <div class="flex items-center gap-3">
                            {% if product.is_on_sale %}
                                <h2 class="text-xl font-bold text-red-600">
                                    {{ product.sale_price|money }}
                                </h2>
                                <span class="text-gray-400 line-through">
                                    {{ product.regular_price|money }}
                                </span>
                            {% else %}
                                <h2 class="text-xl font-bold">
                                    {{ product.price|money }}
                                </h2>
                            {% endif %}
                        </div>
                    </div>

                    {# خيارات المنتج #}
                    {% if product.has_options %}
                        {% include 'pages.partials.product.options' %}
                    {% endif %}

                    {# نموذج الشراء #}
                    <form class="product-form space-y-6" method="post"
                          onsubmit="return salla.form.onSubmit('cart.addItem', event)">
                        <input type="hidden" name="id" value="{{ product.id }}">

                        {# الكمية #}
                        {% if not product.is_hidden_quantity %}
                            <div class="quantity-wrapper">
                                <label class="block text-sm font-medium mb-2">
                                    {{ trans('pages.products.quantity') }}
                                </label>
                                <salla-quantity-input
                                    max="{{ product.max_quantity }}"
                                    value="1"
                                    name="quantity"
                                    class="w-full">
                                </salla-quantity-input>
                            </div>
                        {% endif %}

                        {# زر الإضافة للسلة #}
                        <div class="add-to-cart-wrapper">
                            <salla-add-product-button
                                product-id="{{ product.id }}"
                                product-status="{{ product.status }}"
                                product-type="{{ product.type }}"
                                class="w-full h-12"
                                {{ product.is_require_shipping ? 'required-shipping' : '' }}>
                                {{ product.add_to_cart_label }}
                            </salla-add-product-button>
                        </div>
                    </form>
                </div>

                {# الوصف #}
                <div class="product-description prose mt-8">
                    <h3 class="text-lg font-bold mb-4">{{ trans('pages.products.description') }}</h3>
                    {{ product.description|raw }}
                </div>

                {# معلومات إضافية #}
                {% if product.sku or product.weight %}
                    <div class="product-meta mt-6 p-4 bg-gray-50 rounded-lg space-y-2">
                        {% if product.sku %}
                            <div class="flex items-center gap-2">
                                <span class="text-gray-600">{{ trans('pages.products.sku') }}:</span>
                                <span class="font-medium">{{ product.sku }}</span>
                            </div>
                        {% endif %}
                        {% if product.weight %}
                            <div class="flex items-center gap-2">
                                <span class="text-gray-600">{{ trans('pages.products.weight') }}:</span>
                                <span class="font-medium">{{ product.weight }}</span>
                            </div>
                        {% endif %}
                    </div>
                {% endif %}
            </div>
        </div>

        {# المنتجات المشابهة #}
        <div class="related-products mt-16">
            <salla-products-slider 
                source="related" 
                source-value="{{product.id}}" 
                block-title="{{trans('pages.products.similar_products')}}" 
                display-all-url>
            </salla-products-slider>
        </div>

        {# التعليقات #}
        <salla-comments 
            item-id="{{product.id}}" 
            type="product"
            class="mt-16">
        </salla-comments>

        {# التبويبات #}
        <div class="product-tabs mt-12">
            <salla-tabs>
                {# وصف المنتج #}
                <div slot="tabs">
                    <button class="tab-trigger" data-tab="description">
                        {{ trans('pages.products.description') }}
                    </button>
                    <button class="tab-trigger" data-tab="reviews">
                        {{ trans('pages.products.reviews') }}
                    </button>
                    <button class="tab-trigger" data-tab="questions">
                        {{ trans('pages.products.questions') }}
                    </button>
                </div>

                {# محتوى التبويبات #}
                <div slot="panels">
                    {# وصف المنتج #}
                    <div class="tab-panel" data-tab="description">
                        <div class="prose max-w-none">
                            {{ product.description|raw }}
                        </div>
                    </div>

                    {# التقييمات #}
                    <div class="tab-panel" data-tab="reviews">
                        <salla-product-reviews 
                            product-id="{{ product.id }}">
                        </salla-product-reviews>
                    </div>

                    {# الأسئلة #}
                    <div class="tab-panel" data-tab="questions">
                        <salla-product-questions
                            product-id="{{ product.id }}">
                        </salla-product-questions>
                    </div>
                </div>
            </salla-tabs>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script defer src="{{ 'product.js' | asset }}"></script>
    {% if product.has_3d_image %}
        <script type="module" defer src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    {% endif %}
{% endblock %}
